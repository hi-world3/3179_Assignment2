{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "Victoria's Natural Population Increase by LGA"
  },
  "width": 620,
  "height": 500,
  "projection": {"type": "mercator"},
  "data": {
    "url": "vic_birth_death.csv",
    "format": {
      "parse": {
        "Births": "number",
        "Deaths": "number",
        "Year": "number"
      }
    }
  },
  "params": [
    {
      "name": "year_radio",
      "value": 2023,
      "bind": {
        "input": "radio",
        "options": [2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023],
        "name": "Year: "
      }
    }
  ],
  "transform": [
    { "filter": "toNumber(datum.Year) == year_radio" },
    {
      "lookup": "ABSLGACODE",
      "from": {
        "data": {
          "url": "LGA_POLYGON.json",
          "format": {"type": "topojson", "feature": "LGA_POLYGON"}
        },
        "key": "properties.ABSLGACODE"
      },
      "as": "geo"
    },
    { "filter": "isValid(datum.geo)" },
    {
      "calculate": "datum['Natural Increases'] <= -100 ? 'Decline (<-100)' : datum['Natural Increases'] < 0 ? 'Decline (-99 to -1)' : datum['Natural Increases'] <= 100 ? 'Growth (0 to 100)' : 'Strong Growth (>100)'",
      "as": "change_category"
    }
  ],
  "mark": {"type": "geoshape", "stroke": "white", "strokeWidth": 1},
  "encoding": {
    "shape": {"field": "geo", "type": "geojson"},
    "color": {
      "field": "change_category",
      "type": "ordinal",
      "scale": {
        "domain": ["Strong Growth (>100)", "Growth (0 to 100)", "Decline (-99 to -1)", "Decline (<-100)"],
        "range": ["#2166ac", "#67a9cf", "#ef8a62", "#b2182b"]
      },
      "legend": {"orient": "right", "title": "Natural Increase (Births - Deaths)"}
    },
    "tooltip": [
      {"field": "LGA", "type": "nominal", "title": "LGA"},
      {"field": "Year", "type": "ordinal"},
      {"field": "Births", "type": "quantitative"},
      {"field": "Deaths", "type": "quantitative"},
      {"field": "Natural Increases", "type": "quantitative", "title": "Natural Increase"}
    ]
  }
}